<?php

/**
 * @file
 * Content Direct module file.
 */

use Drupal\Core\Entity\EntityInterface;

/**
 * Implements hook_help().
 */
function content_direct_help($route_name) {
  switch ($route_name) {
    case 'content_direct.help':
      $output = '';
      $output .= '<h3>' . t('About') . '</h3>';
      $output .= '<p>' . t('This is the help docs for Content Direct, see <a href="!content_direct-module">the online documentation</a></p>');
      return $output;
  }
}

/**
 * Implements hook_entity_operation().
 */
function content_direct_entity_operation(EntityInterface $entity) {
    $operations = array();
    if (\Drupal::currentUser()->hasPermission('use_content_direct')) {
        $entity_type = $entity->getEntityType()->id();
        if ($entity_type == 'node') {
            $operations['content_direct'] = array(
                'title' => t('Content Direct'),
                'weight' => 100,
                'url' => \Drupal\Core\Url::fromRoute("content_direct.node_actions", array(
                    $entity->getEntityTypeId() => $entity->id(),
                )),
            );
        }
        elseif ($entity_type == 'file') {
            $operations['content_direct'] = array(
                'title' => t('Content Direct'),
                'weight' => 100,
                'url' => \Drupal\Core\Url::fromRoute("content_direct.file_actions", array(
                    $entity->getEntityTypeId() => $entity->id(),
                )),
            );
        }

        // @TODO: Not able to alter operations for taxonomy terms
        // see: Patch expected for 8.2.x https://www.drupal.org/node/2469567
//        elseif ($entity_type == 'taxonomy_term') {
//            $operations['content_direct'] = array(
//                'title' => t('Content Direct'),
//                'weight' => 100,
//                'url' => \Drupal\Core\Url::fromRoute("content_direct.term_actions", array(
//                    $entity->getEntityTypeId() => $entity->id(),
//                )),
//            );
//        }
    }
    return $operations;
}
